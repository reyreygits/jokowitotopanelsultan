<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel JNT-4D</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDzikWeuSIoMTCC6wsD64NnX5bLQQvM2dA",
  authDomain: "ariptoto-93af7.firebaseapp.com",
  projectId: "ariptoto-93af7",
  storageBucket: "ariptoto-93af7.appspot.com",
  messagingSenderId: "703805134804",
  appId: "1:703805134804:web:402e7f9e378ae1ecdb2841"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let isAdmin=false;
</script>

<style>
body { margin:0; font-family:Arial,sans-serif; background:#0a0f1c; color:white; }
header { background:#111a33; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
header h1 { color:#FFD700; font-size:20px; margin:0; }
.form-box { background:#111a33; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.6); max-width:800px; margin:20px auto; }
.form-box input, .form-box button { width:100%; padding:10px; margin:8px 0; border:none; border-radius:6px; font-size:14px; }
button { cursor:pointer; font-weight:bold; }
.card { background:#111a33; padding:15px; border-radius:8px; border:2px solid #FFD700; margin-bottom:10px; }
.card p, .card label { color:#FFD700; margin:4px 0; }
button.approve { background:#00cc66; color:#000; margin-right:5px; }
button.reject { background:#ff4444; color:#000; margin-right:5px; }
button.save { background:#ffcc00; color:#000; margin-top:5px; }
button.back { background:#888; color:white; margin-top:10px; }
input.edit { width:90%; margin:2px 0; padding:4px; border-radius:4px; border:none; }
</style>
</head>

<body>
<!-- ===== Admin Login Page ===== -->
<div id="loginPage" class="page">
  <div class="form-box">
    <h2>Admin Login</h2>
    <input type="text" id="adminUser" placeholder="Username" />
    <input type="password" id="adminPass" placeholder="Password" />
    <button onclick="loginAdmin()">Login</button>
  </div>
</div>

<!-- ===== Admin Panel ===== -->
<div id="adminPage" class="page" style="display:none;">
<header><h1>üíº Admin Panel JNT-4D</h1></header>

<div class="form-box">
<h2>Daftar User</h2>
<div id="userList" style="max-height:300px; overflow-y:auto;"></div>
</div>

<div class="form-box">
<h2>Daftar Deposit / Withdraw</h2>
<div id="txList" style="max-height:300px; overflow-y:auto;"></div>
</div>

<button class="back" onclick="logoutAdmin()">‚¨ÖÔ∏è Logout</button>
</div>

<script>
// --- Admin Login ---
function loginAdmin(){
  const u=document.getElementById("adminUser").value;
  const p=document.getElementById("adminPass").value;
  if(u==="admin" && p==="admin123"){ 
    isAdmin=true; showAdminPage();
  } else {
    alert("Login Admin gagal!");
  }
}

// --- Show Admin Page ---
function showAdminPage(){
  document.getElementById("loginPage").style.display="none";
  document.getElementById("adminPage").style.display="block";
  loadUsers();
  loadTransactions();
}

// --- Logout Admin ---
function logoutAdmin(){
  isAdmin=false;
  document.getElementById("loginPage").style.display="block";
  document.getElementById("adminPage").style.display="none";
}

// --- Load Users ---
function loadUsers(){
  const div=document.getElementById("userList");
  div.innerHTML="Loading...";
  db.collection("users").get().then(snap=>{
    div.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <p><strong>User:</strong> ${doc.id}</p>
        <label>Nama Rekening:</label>
        <input class="edit" id="nama-${doc.id}" value="${d.nama}" />
        <label>No. Rekening:</label>
        <input class="edit" id="rek-${doc.id}" value="${d.rekening}" />
        <label>Bank/E-Wallet:</label>
        <input class="edit" id="bank-${doc.id}" value="${d.bank}" />
        <label>Saldo (Rp):</label>
        <input class="edit" id="bal-${doc.id}" type="number" value="${d.balance}" />
        <button class="save" onclick="saveUser('${doc.id}')">Save</button>
      `;
      div.appendChild(card);
    });
  });
}

// --- Save User Data ---
function saveUser(id){
  const n=document.getElementById(`nama-${id}`).value;
  const r=document.getElementById(`rek-${id}`).value;
  const b=document.getElementById(`bank-${id}`).value;
  const bal=parseInt(document.getElementById(`bal-${id}`).value) || 0;
  db.collection("users").doc(id).update({nama:n,rekening:r,bank:b,balance:bal})
  .then(()=>{alert("Data user berhasil diupdate!"); loadUsers();});
}

// --- Load Transactions ---
function loadTransactions(){
  const div=document.getElementById("txList");
  div.innerHTML="Loading...";
  db.collection("history").orderBy("date","desc").get().then(snap=>{
    div.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      if(d.type!=="Deposit" && d.type!=="Withdraw") return;
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <p><strong>User:</strong> ${d.user}</p>
        <p><strong>Tipe:</strong> ${d.type}</p>
        <p><strong>Nominal:</strong> Rp ${d.amount}</p>
        <p><strong>Status:</strong> <span id="status-${doc.id}">${d.status}</span></p>
        <button class="approve" onclick="approveTx('${doc.id}')">Approve</button>
        <button class="reject" onclick="rejectTx('${doc.id}')">Reject</button>
      `;
      div.appendChild(card);
    });
  });
}

// --- Approve Transaction ---
function approveTx(id){
  const txRef=db.collection("history").doc(id);
  txRef.get().then(doc=>{
    if(!doc.exists){alert("Data tidak ditemukan"); return;}
    const d=doc.data();
    txRef.update({status:"Approved"}).then(()=>{
      document.getElementById(`status-${id}`).innerText="Approved";
      const userRef=db.collection("users").doc(d.user);
      userRef.get().then(uDoc=>{
        if(!uDoc.exists){alert("User tidak ditemukan"); return;}
        let balance=uDoc.data().balance || 0;
        if(d.type==="Deposit") balance+=d.amount;
        if(d.type==="Withdraw") balance-=d.amount;
        userRef.update({balance}).then(()=>loadUsers());
      });
    });
  });
}

// --- Reject Transaction ---
function rejectTx(id){
  const txRef=db.collection("history").doc(id);
  txRef.update({status:"Rejected"}).then(()=>{
    document.getElementById(`status-${id}`).innerText="Rejected";
  });
}
</script>
</body>
</html>
