<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAXBET4D - Admin Panel</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDzikWeuSIoMTCC6wsD64NnX5bLQQvM2dA",
  authDomain: "AIzaSyDzikWeuSIoMTCC6wsD64NnX5bLQQvM2dA",
  projectId: "ariptoto-93af7",
  storageBucket: "ariptoto-93af7.appspot.com",
  messagingSenderId: "703805134804",
  appId: "1:703805134804:web:402e7f9e378ae1ecdb2841"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0a0f1c;
    color: white;
    margin: 0;
    padding: 0;
  }
  header {
    background: #111a33;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  .logo {
    font-size: 24px;
    font-weight: bold;
    color: #FFD700;
  }
  /* Login form style */
  #loginForm {
    max-width: 320px;
    margin: 100px auto;
    background: #111a33;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 0 12px #222;
  }
  #loginForm h2 {
    margin-bottom: 20px;
    text-align: center;
    color: #FFD700;
  }
  #loginForm input {
    width: 100%;
    padding: 10px;
    margin: 8px 0 16px 0;
    border-radius: 6px;
    border: none;
    font-size: 16px;
  }
  #loginForm button {
    width: 100%;
    padding: 10px;
    background: #FFD700;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    color: black;
    font-size: 16px;
  }
  #loginError {
    color: #ff4444;
    text-align: center;
    margin-bottom: 10px;
  }

  /* Admin panel hidden by default */
  #adminPanel {
    display: none;
  }
  /* Sisanya bisa pakai style kamu yang sudah ada */
  /* ... (style admin panel sama seperti sebelumnya) */
</style>
</head>

<body>

<!-- Login Form -->
<div id="loginForm">
  <h2>Login Admin</h2>
  <div id="loginError"></div>
  <input type="text" id="adminId" placeholder="Admin ID" />
  <input type="password" id="adminPass" placeholder="Password" />
  <button onclick="doLogin()">Masuk</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
<header><div class="logo">ARIPTOTO - Admin Panel</div></header>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Cari UserID / Nama Rekening / No Rekening" />
  <button onclick="loadAdminData()">üîç Cari</button>
  <button onclick="loadAdminData()">üîÑ Refresh</button>
</div>

<div class="container">
  <!-- ... semua isi admin panel kamu yang sebelumnya ... -->
  <!-- Aku singkat supaya gak terlalu panjang -->
  <h2>üìã Users List</h2>
  <table id="usersTable">
    <thead>
      <tr>
        <th>UserID</th><th>Password</th><th>Nama Rekening</th><th>No Rekening</th><th>Bank</th><th>Phone</th><th>Balance</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>üí≥ Deposit List</h2>
  <table id="depositsTable">
    <thead>
      <tr>
        <th>UserID</th><th>Amount</th><th>Status</th><th>Created At</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>üèß Withdraw List</h2>
  <table id="withdrawsTable">
    <thead>
      <tr>
        <th>UserID</th><th>Amount</th><th>Status</th><th>Created At</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</div>

<script>
// Hardcoded admin credentials (ganti sesuai kebutuhan)
const ADMIN_CREDENTIALS = {
  id: "admin",
  password: "admin123"
};

function doLogin() {
  const idInput = document.getElementById('adminId').value.trim();
  const passInput = document.getElementById('adminPass').value.trim();
  const errorDiv = document.getElementById('loginError');

  if (idInput === ADMIN_CREDENTIALS.id && passInput === ADMIN_CREDENTIALS.password) {
    // Sukses login
    errorDiv.textContent = "";
    document.getElementById('loginForm').style.display = "none";
    document.getElementById('adminPanel').style.display = "block";

    // Load data admin
    loadAdminData();
  } else {
    // Gagal login
    errorDiv.textContent = "ID atau Password salah!";
  }
}

// (Semua fungsi admin panel kamu tetap sama, contoh: loadAdminData dll)
// Salin fungsi yang sudah kamu punya dari kode sebelumnya di sini
// Contohnya:

let usersData = [];
let currentPage = 1;
const usersPerPage = 12;

function fmtDate(ts) {
  if (!ts) return "";
  try {
    if (ts.toDate) return ts.toDate().toLocaleString();
    return new Date(ts).toLocaleString();
  } catch (e) {
    return String(ts);
  }
}

async function loadAdminData() {
  const searchVal = document.getElementById("searchInput").value.trim().toLowerCase();

  // --- Ambil data semua users ---
  const usersSnap = await db.collection("users").orderBy("createdAt", "desc").get();
  usersData = [];
  usersSnap.forEach((u) => {
    const data = u.data();
    const match =
      !searchVal ||
      u.id.toLowerCase().includes(searchVal) ||
      (data.namaRekening && data.namaRekening.toLowerCase().includes(searchVal)) ||
      (data.rekening && data.rekening.toLowerCase().includes(searchVal));
    if (match) usersData.push({ id: u.id, ...data });
  });
  currentPage = 1;
  renderUsers();

  // --- Deposit List ---
  const depsT = document.getElementById("depositsTable").querySelector("tbody");
  depsT.innerHTML = "";
  const depsSnap = await db.collection("deposits").orderBy("createdAt", "desc").get();
  depsSnap.forEach((d) => {
    const data = d.data();
    const tr = document.createElement("tr");
    const dateStr = fmtDate(data.createdAt);
    tr.innerHTML = `
      <td>${data.user}</td>
      <td>Rp ${data.amount}</td>
      <td><span class="status-badge ${
        data.status === "pending"
          ? "status-pending"
          : data.status === "approved"
          ? "status-approved"
          : "status-rejected"
      }">${data.status}</span></td>
      <td>${dateStr}</td>
      <td>
        ${
          data.status === "pending"
            ? `<button class="btn-action btn-approve" onclick="approveDeposit('${d.id}')">Approve</button>
               <button class="btn-action btn-reject" onclick="rejectDeposit('${d.id}')">Reject</button>`
            : "-"
        }
      </td>
    `;
    if (data.status === "pending") depsT.prepend(tr);
    else depsT.appendChild(tr);
  });

  // --- Withdraw List ---
  const wT = document.getElementById("withdrawsTable").querySelector("tbody");
  wT.innerHTML = "";
  const wSnap = await db.collection("withdraws").orderBy("createdAt", "desc").get();
  wSnap.forEach((d) => {
    const data = d.data();
    const tr = document.createElement("tr");
    const dateStr = fmtDate(data.createdAt);
    tr.innerHTML = `
      <td>${data.user}</td>
      <td>Rp ${data.amount}</td>
      <td><span class="status-badge ${
        data.status === "pending"
          ? "status-pending"
          : data.status === "approved"
          ? "status-approved"
          : "status-rejected"
      }">${data.status}</span></td>
      <td>${dateStr}</td>
      <td>
        ${
          data.status === "pending"
            ? `<button class="btn-action btn-approve" onclick="approveWithdraw('${d.id}')">Approve</button>
               <button class="btn-action btn-reject" onclick="rejectWithdraw('${d.id}')">Reject</button>`
            : "-"
        }
      </td>
    `;
    if (data.status === "pending") wT.prepend(tr);
    else wT.appendChild(tr);
  });
}

// (Lanjutkan fungsi lainnya dari kode admin panel kamu sesuai kebutuhan)

</script>
</body>
</html>
