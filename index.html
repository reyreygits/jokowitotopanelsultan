<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel - JNT4D</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDzikWeuSIoMTCC6wsD64NnX5bLQQvM2dA",
  authDomain: "ariptoto-93af7.firebaseapp.com",
  projectId: "ariptoto-93af7",
  storageBucket: "ariptoto-93af7.appspot.com",
  messagingSenderId: "703805134804",
  appId: "1:703805134804:web:402e7f9e378ae1ecdb2841"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let isAdmin = false;

// Admin credentials
const adminCredentials = { username:"admin", password:"Admin123" };

// --- Login Admin ---
function loginAdmin(){
  const u = document.getElementById("adminUser").value;
  const p = document.getElementById("adminPass").value;
  if(u === adminCredentials.username && p === adminCredentials.password){
    isAdmin = true;
    showAdminPage();
  } else {
    alert("Login Admin gagal! Username atau Password salah.");
  }
}

// --- Show Admin Page ---
function showAdminPage(){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  document.getElementById("adminPage").style.display="block";
  loadPlayers();
  loadDeposits();
}

// --- Load Players ---
function loadPlayers(){
  const list = document.getElementById("playerList");
  list.innerHTML="";
  db.collection("users").get().then(snap=>{
    snap.forEach(doc=>{
      const d = doc.data();
      const div = document.createElement("div");
      div.style.border="1px solid #FFD700";
      div.style.margin="5px";
      div.style.padding="5px";
      div.innerHTML=`
        <b>${doc.id}</b><br>
        Password: <input value="${d.password}" id="pw_${doc.id}" style="width:80px;">
        | Bank: <input value="${d.bank}" id="bank_${doc.id}" style="width:100px;">
        | Rekening: <input value="${d.rekening}" id="rek_${doc.id}" style="width:100px;">
        | Nama: <input value="${d.nama}" id="nama_${doc.id}" style="width:100px;">
        | HP: <input value="${d.phone}" id="phone_${doc.id}" style="width:100px;">
        <button onclick="updatePlayer('${doc.id}')">Update</button>
      `;
      list.appendChild(div);
    });
  });
}

// --- Update Player ---
function updatePlayer(uid){
  const pw = document.getElementById(`pw_${uid}`).value;
  const bank = document.getElementById(`bank_${uid}`).value;
  const rek = document.getElementById(`rek_${uid}`).value;
  const nama = document.getElementById(`nama_${uid}`).value;
  const phone = document.getElementById(`phone_${uid}`).value;
  db.collection("users").doc(uid).update({password:pw, bank:bank, rekening:rek, nama:nama, phone:phone})
  .then(()=>{ alert(`Data ${uid} berhasil diupdate`); });
}

// --- Load Deposit History ---
function loadDeposits(){
  const list = document.getElementById("depositList");
  list.innerHTML="";
  db.collection("history").where("type","==","Deposit").where("status","==","Pending").get().then(snap=>{
    snap.forEach(doc=>{
      const d = doc.data();
      const div = document.createElement("div");
      div.style.border="1px solid #00cc66";
      div.style.margin="5px";
      div.style.padding="5px";
      div.innerHTML=`<b>${d.user}</b> - Rp ${d.amount} | 
        <button onclick="approveDeposit('${doc.id}',${d.amount},'${d.user}')">Approve</button>
        <button onclick="rejectDeposit('${doc.id}')">Reject</button>`;
      list.appendChild(div);
    });
  });
}

// --- Approve Deposit ---
function approveDeposit(docId,amount,uid){
  // Update history
  db.collection("history").doc(docId).update({status:"Approved"}).then(()=>{
    // Update user balance
    db.collection("users").doc(uid).get().then(doc=>{
      const userData = doc.data();
      const newBalance = (userData.balance || 0) + amount;
      db.collection("users").doc(uid).update({balance:newBalance}).then(()=>{
        alert(`Deposit Rp ${amount} dari ${uid} diapprove`);
        loadDeposits();
      });
    });
  });
}

// --- Reject Deposit ---
function rejectDeposit(docId){
  db.collection("history").doc(docId).update({status:"Rejected"}).then(()=>{
    alert("Deposit ditolak");
    loadDeposits();
  });
}

</script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#0a0f1c;color:white;}
.page{display:none;padding:15px;max-width:900px;margin:auto;}
.active{display:block;}
input,button{padding:5px;margin:2px;border-radius:4px;border:none;}
button{cursor:pointer;}
header{background:#111a33;padding:10px;margin-bottom:10px;}
</style>
</head>
<body>

<!-- Admin Login -->
<div id="adminLogin" class="page active">
<header><h2>Login Admin</h2></header>
<input type="text" id="adminUser" placeholder="Username"><br>
<input type="password" id="adminPass" placeholder="Password"><br>
<button onclick="loginAdmin()">Login</button>
</div>

<!-- Admin Panel -->
<div id="adminPage" class="page">
<header><h2>ðŸ›  Admin Panel</h2></header>
<h3>Pemain Terdaftar</h3>
<div id="playerList" style="max-height:300px;overflow:auto;border:1px solid #444;padding:5px;"></div>

<h3>Deposit Pending</h3>
<div id="depositList" style="max-height:300px;overflow:auto;border:1px solid #444;padding:5px;"></div>

<br>
<button onclick="location.reload()">Logout</button>
</div>

</body>
</html>
